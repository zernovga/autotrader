# ML Autotrader

# TODO:

## **1. Infrastructure & Setup**

* [ ] Настроить базовую структуру директорий (`ingest/`, `processing/`, `orders/`, `utils/`, `data/`).
* [ ] Подготовить Dockerfile для основных сервисов.
* [ ] Поднять Docker Compose окружение:

  * [ ] Kafka / NATS / Redis Streams (на выбор)
  * [ ] Zookeeper (если Kafka)
  * [ ] Вспомогательные контейнеры (UI for Kafka, Redis Insight — опционально)

---

## **2. Market Data Ingest**

* [ ] Реализовать WebSocket-клиент для брокера/биржи.
* [ ] Нормализовать формат данных (timestamp, price, size, symbol).
* [ ] Реализовать асинхронную отправку тиков в broker (`market.raw`).
* [ ] Добавить логирование ошибок и reconnect-логику.
* [ ] Создать конфиг для выбора символа (BTCUSDT, EURUSD, и т.п.).

---

## **3. Stream Processing (Simple Signal Logic)**

* [ ] Создать воркер `signal_worker`.
* [ ] Подписаться на поток `market.raw`.
* [ ] Реализовать простейшие фичи:

  * [ ] MA(10)
  * [ ] MA(30)
  * [ ] Δprice
* [ ] Добавить правило: MA(10) > MA(30) → LONG; наоборот → SHORT.
* [ ] Публиковать результат в `signals.candidate`.
* [ ] Добавить базовые дебаг-логи (signal generated, price, MA values).

---

## **4. Risk Gate (MVP)**

* [ ] Создать воркер `risk_gate`.
* [ ] Подписаться на `signals.candidate`.
* [ ] Реализовать проверки:

  * [ ] Нет активной позиции.
  * [ ] Ограничение количества сделок в минуту/час.
  * [ ] Ограничение объема позиции.
* [ ] Отправлять валидированные сигналы в `signals.approved`.
* [ ] Логировать отклонённые сигналы.

---

## **5. Order Manager**

* [ ] Реализовать модуль `order_manager`.
* [ ] Поддержать отправку ордеров в брокер (REST API).
* [ ] Добавить идемпотентность (не создавать дубликаты).
* [ ] Обрабатывать ответ брокера:

  * [ ] успешное создание
  * [ ] ошибки
* [ ] (Опционально) Отслеживать выполнение ордеров.
* [ ] Публиковать статус в `orders.events` или писать в лог.

---

## **6. Telegram Notifications**

* [ ] Поднять Telegram-бота (aiogram).
* [ ] Реализовать отправку уведомлений:

  * [ ] Новый сигнал (candidate)
  * [ ] Сигнал одобрен (approved)
  * [ ] Ордер создан
  * [ ] Ошибки
* [ ] Добавить форматирование сообщений.
* [ ] Вынести TG token в переменные окружения.

---

## **7. Data Storage for ML**

* [ ] Создать каталог `/data/raw/`.
* [ ] Сохранять сырые тики (Parquet/CSV).
* [ ] Партиционировать по дате и символу.
* [ ] Проверить производительность записи.
* [ ] Добавить фоновую ротацию/очистку файлов.

---

## **8. Logging & Basic Monitoring**

* [ ] Добавить структурированные логи (JSON).
* [ ] Реализовать `healthcheck` endpoint для каждого сервиса.
* [ ] Настроить уровень логирования (DEBUG/INFO/ERROR).
* [ ] Добавить метрики:

  * [ ] количество сигналов
  * [ ] количество ошибок
  * [ ] latency обработки

---

## **9. Integration Tests / End-to-End**

* [ ] Тест: имитация входящего тика → сигнал → approval → ордер.
* [ ] Тест: сигнал отклоняется Risk Gate.
* [ ] Тест: проверка идемпотентности ордеров.
* [ ] Тест: работоспособность reconnect WebSocket.
* [ ] Тест: уведомления в Telegram.
